<!DOCTYPE html>
<meta charset="UTF-8">
<html lang="en">

<head>

  <!-- Bootstrap -->
  <link href="bootstrap3/css/bootstrap.css" rel="stylesheet">
  
  <!-- jQuery -->
  <script src="bootstrap3/jquery/jquery-1.10.2.js" type="text/javascript"></script>
  <script type="text/javascript" src="bootstrap3/jquery/jquery-ui.custom.min.js"></script>

  <!-- JS -->
  <script src="bootstrap3/js/bootstrap.js" type="text/javascript"></script>

  <!-- Titles -->
  <link rel="icon" href="https://image.flaticon.com/icons/png/512/18/18057.png"> <!-- TODO: add ribbon -->
  <title>HIITimer</title>

  <!-- Fonts -->
  <!-- <link href="https://fonts.googleapis.com/css?family=Exo:300|Share+Tech+Mono|Orbitron:400,700,500,900" rel="stylesheet"> -->

  <!-- Custom Style -->
  <style>
    @font-face {
      font-family: 'Exo';
      font-style: normal;
      font-weight: 300;
      src: url('./fonts/exo-v6-latin-300.eot'); /* IE9 Compat Modes */
      src: local('Exo Light'), local('Exo-Light'),
           url('./fonts/exo-v6-latin-300.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
           url('./fonts/exo-v6-latin-300.woff2') format('woff2'), /* Super Modern Browsers */
           url('./fonts/exo-v6-latin-300.woff') format('woff'), /* Modern Browsers */
           url('./fonts/exo-v6-latin-300.ttf') format('truetype'), /* Safari, Android, iOS */
           url('./fonts/exo-v6-latin-300.svg#Exo') format('svg'); /* Legacy iOS */
    }

    @font-face {
      font-family: 'Share Tech Mono';
      font-style: normal;
      font-weight: 400;
      src: url('./fonts/share-tech-mono-v7-latin-regular.eot'); /* IE9 Compat Modes */
      src: local('Share Tech Mono'), local('ShareTechMono-Regular'),
           url('./fonts/share-tech-mono-v7-latin-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
           url('./fonts/share-tech-mono-v7-latin-regular.woff2') format('woff2'), /* Super Modern Browsers */
           url('./fonts/share-tech-mono-v7-latin-regular.woff') format('woff'), /* Modern Browsers */
           url('./fonts/share-tech-mono-v7-latin-regular.ttf') format('truetype'), /* Safari, Android, iOS */
           url('./fonts/share-tech-mono-v7-latin-regular.svg#ShareTechMono') format('svg'); /* Legacy iOS */
    }

    body, code {
      font-family: 'Exo', sans-serif;
      font-weight: 300;
      font-size: 16px;
    }
  
    code {
      padding-top: 6px;
    }

    body.dark-theme {
      background-color: #111;
      color: #eee;
    }

    footer.footer {
        text-align: center;
        color: #777;
        line-height: 27px;
        position: relative;
        top: 240px;
    }

    body.dark-theme code {
      /* red */
      /*background-color: rgba(199, 37, 78, 0.7);
      color: #f9f2f4;*/

      /* green */
      background-color: rgba(7, 238, 0, 0.65);
      color: white;
    }

    .countdown-container {
      width: 300px;
      padding-top: 150px;
      position: relative;
      left: 20px;
    }

    #countdown {
      font-family: 'Share Tech Mono', monospace;
      font-weight: 400;
      letter-spacing: -7px;
      font-size: 220px;
      margin: auto;
    }

    .big-button-container {
      width: 300px; 
      padding-top: 50px;
    }

    #big-button {
      font-family: 'Exo', sans-serif;
      text-transform: uppercase;
      margin: auto;
      border: none;
      line-height: calc(1.25rem + 4px);
      width: 280px;
      height: 60px;
      font-size: 18px;
    }

    #big-button.green {      
      background-image: linear-gradient(90deg,#00d9bf,#00d977);
      box-shadow: 0 3px 0 0 #00bb85, 0 2px 8px 0 #00d99b, 0 4px 10px 0 rgba(33,7,77,.5);
      text-shadow: 0 1px 3px rgba(0,0,0,.3);
    }

    #big-button.green:hover,
    #big-button.green:focus {
      background-image: linear-gradient(90deg,#24dec8,#24de8a);
      /*box-shadow: none;*/
      border-color: transparent;
      outline: 0;
    }

    #big-button.green:active {
      background-image: linear-gradient(90deg,#00bba5,#0b6);
      box-shadow: none;
      border-color: transparent;
    }
  </style>
</head>
<body class='dark-theme'>
  <div class='container countdown-container'>
      <span id='countdown'>15</span> sec
  </div>
  <div class='container big-button-container'>
    <button class='btn btn-success green' id='big-button'>Start</button>
  </div>
<!--   <footer class='footer'>
    <code>Space</code> to start/stop<br/>
    <code>R</code> to reset
  </footer> -->

  <!-- Custom Script -->
  <script>
    var countdownHtml = $('#countdown').html();
    var countdown = parseInt(countdownHtml);
    console.log(countdown);

    var globalFlag = false;
    var timer;

    var msg;
    speechSetup();

    // start
    $('#big-button').on('click', function() {
        if (globalFlag == false) {
          timerOn();
          // console.log("ON");
        } else {
          clearInterval(timer);
          timerOff();          
          // console.log("OFF");
        }
    });

    function timerOn() {
      globalFlag = true;
      speak('開始');

      timer = setInterval(function() {
        countdown--;
        $('#countdown').html(countdown);

        if (countdown == 0) {
          clearInterval(timer);
        }
      }, 1000);
      // countdown is now zero
      console.log("finished");
    }

    function speak(number) {
      msg.text = number;
      speechSynthesis.speak(msg);
    }

    function timerOff() {
      globalFlag = false;
      speak('停止');
      clearInterval(timer);
    }

    function speechSetup() {
        msg = new SpeechSynthesisUtterance();
        var voices = window.speechSynthesis.getVoices();
        msg.voice = voices[81]; // Note: some voices don't support altering params
        // msg.voiceURI = 'native';
        msg.volume = 1; // 0 to 1
        msg.rate = 1; // 0.1 to 10
        msg.pitch = 2; //0 to 2
        msg.lang = 'zh-HK';
        // msg.lang = 'en-AU';
    }
  </script>
</body>
</html>